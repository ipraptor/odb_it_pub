# Разбор IPsec VPN
#VPN #IPsec 

# Определение (c Wikipedia)
IPsec (сокращение от IP Security) — набор протоколов для обеспечения защиты данных, передаваемых по межсетевому протоколу IP. Позволяет осуществлять подтверждение подлинности (аутентификацию), проверку целостности и/или шифрование IP-пакетов. IPsec также включает в себя протоколы для защищённого обмена ключами в сети Интернет. В основном применяется для организации VPN-соединений.

# Понимание
Основная база по IPsec и тому как его настраивать и дебажить, это понимать когда и что происходит.
У IPsec есть две фазы:
1) ISAKMP SA (Security Association):
- - 1.1) Передача AH хэша (не секьюрно) или ESA шифра
- - 1.2) DH (Обмен по Диффи_Хелману), обмен PSK (PreSharedKey) или другими ключами\сертификатами с сервером партнёром
Цель первой фазы установить секьюрный коннект с партнёром и договориться о параметрах безопасности и ключах.
2) IPsec SA
- - Поднятие тоннеля IPsec
- - Применение указанных фильтров по портам и адресам и т д + время жизни тоннеля (про последнее не уверен)
- - Обмен данными
Вторая фаза по сути уже поднятие самого VPNа и трафика по нему.
Подробную диаграмму по разбору протокола IPsec можно посмотреть в следующем посте.

> [!Note]
:information_source: Режимы IPsec не являются взаимоисключающими. На одном и том же узле некоторые SA могут использовать транспортный режим, а другие — туннельный.

![](https://i.imgur.com/BcOPbB7.png)



![](https://i.imgur.com/fILSKv0.png)
![](https://i.imgur.com/1X0PAh7.png)
